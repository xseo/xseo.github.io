<!DOCTYPE html>
<html>
  <head>
    <title>How to have Rails auto reload classes in custom directories under app/</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/my.css" rel="stylesheet">
    <link rel="alternate" type="application/rss+xml" title="P/MEAN and co." href="http://demisx.github.io/feed.xml">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <script src="/js/twitter.js"></script>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a href="/">
              <img src="/images/thumb_demisx.jpg" style="width:50px;float:left" class="visible-xs img-responsive" alt="demisx avatar">
              <span class="navbar-brand">P/MEAN and co.</span>
            </a>
          </div>

          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/">Home</a></li>
              <!-- <li><a href="/contact/xxx">Contact</a></li> -->
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/feed.xml"><i class="fa fa-rss fa-lg"></i> RSS</a></li>
              <li><a href="https://github.com/demisx" rel="me" target="_blank"><i class="fa fa-github fa-lg"></i> GitHub</a></li>
              <li><a href="https://twitter.com/demisx1" rel="me" target="_blank"><i class="fa fa-twitter fa-lg"></i> Twitter</a></li>
            </ul>
          </div><!--/.navbar-collapse -->
        </div>
      </nav>
    </header>

    <section id="main" class="container">
      
      <div class="container">
        <div class="row">
          <div id="about-me" class="col-xs-12  col-sm-3 col-sm-push-9 col-md-2 col-md-push-10 hidden-xs">
            <div class="thumbnail">
              <img src="/images/thumb_demisx.jpg" alt="demisx avatar">
              <div class="caption small">
                <b><u>#inspect:</u></b>
                <p>I am Dmitri Moore, full stack programmer. I've been coding for almost 
                2 decades now. I've seen many frameworks going from
                super popular to fairly forgotten. So far, P/MEAN is my favorite stack:<br/>
                <button type="button" class="btn btn-default btn-sm"><u>P</u>ostgreSQL</button>
                <button type="button" class="btn btn-default btn-sm"><u>M</u>ongoDB</button>
                <button type="button" class="btn btn-default btn-sm"><u>E</u>xpress</button>
                <button type="button" class="btn btn-default btn-sm"><u>A</u>ngularJS</button>
                
                <button type="button" class="btn btn-default btn-sm"><u>N</u>ode.js</button>
                <br/>Let's see how long this
                one is gonna stick around. <i class="fa fa-smile-o"></i></p>
              </div> 
            </div>
          </div>
          <div class="col-xs-12 col-sm-9 col-sm-pull-3 col-md-10 col-md-pull-2" id="main-content">
            <h2>How to have Rails auto reload classes in custom directories under app/</h2>
<hr>
<p class="meta">16 Mar 2014</p>

<div class="post">
<p>Over time, your rails models go from being a super model to being fat and eventually end up
obese waiting any time for a heart attack to choke your app. When refactoring such models, I really
like and follow the approach described by Code Climate in <a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/">7 Patterns to Refactor Fat ActiveRecord Models</a>.</p>

<p>Leveraging their technique, I create this directory structure for the new objects:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">app/
----------
  |___controllers/ -&gt; rails default dir to store controller classes
  |___models/      -&gt; rails default dir to store models classes
  |___views/       -&gt; rails default dir to store views classes
  |___... ... ...
  |___decorators/  -&gt; custom dir to store decorator objects
  |___policies/    -&gt; custom dir to store policy objects
  |___presenters/  -&gt; custom dir to store presenter objects
  |___services/    -&gt; custom dir to store service objects
  |___validators/  -&gt; custom dir to store validator objects
  |___... ... ...
</code></pre></div>
<p>and then name space my new objects as I believe it leads to better code organization and 
avoids potential name collisions in the future:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="c1"># Example of a service object in &quot;app/services/doctor_finder.rb&quot; directory</span>
<span class="lineno">2</span> <span class="k">module</span> <span class="nn">Services</span>
<span class="lineno">3</span>   <span class="k">class</span> <span class="nc">DoctorFinder</span>
<span class="lineno">4</span>     <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">find_doctors</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="no">Settings</span><span class="o">.</span><span class="n">finder</span><span class="o">.</span><span class="n">default_distance</span><span class="p">)</span>
<span class="lineno">5</span>       <span class="no">Doctor</span><span class="o">.</span><span class="n">near</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">distance</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">(</span><span class="no">Settings</span><span class="o">.</span><span class="n">finder</span><span class="o">.</span><span class="n">max_results_number</span><span class="p">)</span>
<span class="lineno">6</span>     <span class="k">end</span>
<span class="lineno">7</span>   <span class="k">end</span>
<span class="lineno">8</span> <span class="k">end</span></code></pre></div>

<p>The issue with this approach (Rails 4 at the time of writing) that these classes/objects in custom 
diretories will not be auto reloaded in development environment with default rails config. In fact,
if name spaced, these classes will throw <code>Uninitialized constant [your_calling_class]::Services</code> 
type of exception, because Rails will not know how to resolve your new name spaced constants. 
To resolve this issue and make sure that your classes auto reload, you need to do two things:</p>

<ol>
<li>Update <em>config/application.rb</em> file to add &quot;app/&quot; directory to the auto load paths: 
<code>config.autoload_paths += %W(#{config.root}/app)</code></li>
<li>Make sure you don&#39;t manually require your new classes anywhere in the code. Let Rails magic 
do that for you.</li>
</ol>

<p>That&#39;s all. Your new classes should auto reload now similar to rails default controllers, models, 
views etc. </p>

<p>Special &#39;thank you&#39; to the awesome rails team @fxn, @jeremy, @thedarkone and all others who helped me with 
resolving this issue <a href="https://github.com/rails/rails/issues/14382">Classes not reloaded...</a></p>

<hr>

<h5 id="today-my-environment-was:">Today my environment was:</h5>

<ul>
<li>Rails 4.1.0.rc1</li>
</ul>

</div>

<hr>
 <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'demisx'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'demisx'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
          </div>
        </div>
      </div>
        
      </div>
    </section>

    <footer>
      <div class="container">
        <hr>
        <div id="copyright">
          <p>&copy; 2014 All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-47168884-1', 'demisx.github.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
