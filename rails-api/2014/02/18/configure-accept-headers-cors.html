<!DOCTYPE html>
<html>
  <head>
    <title>How to Configure CORS Accept Headers in Rails API Application</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/syntax.css" rel="stylesheet">
    <link href="/css/my.css" rel="stylesheet">
    <link rel="alternate" type="application/rss+xml" title="P/MEAN and co." href="http://demisx.github.io/feed.xml">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <script src="/js/twitter.js"></script>
  </head>
  <body>
    <header>
      <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a href="/">
              <img src="/images/thumb_demisx.jpg" style="width:50px;float:left" class="visible-xs img-responsive" alt="demisx avatar">
              <span class="navbar-brand">P/MEAN and co.</span>
            </a>
          </div>

          <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="/">Home</a></li>
              <!-- <li><a href="/contact/xxx">Contact</a></li> -->
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="/feed.xml"><i class="fa fa-rss fa-lg"></i> RSS</a></li>
              <li><a href="https://github.com/demisx" rel="me" target="_blank"><i class="fa fa-github fa-lg"></i> GitHub</a></li>
              <li><a href="https://twitter.com/demisx1" rel="me" target="_blank"><i class="fa fa-twitter fa-lg"></i> Twitter</a></li>
            </ul>
          </div><!--/.navbar-collapse -->
        </div>
      </nav>
    </header>

    <section id="main" class="container">
      
      <div class="container">
        <div class="row">
          <div id="about-me" class="col-xs-12  col-sm-3 col-sm-push-9 col-md-2 col-md-push-10 hidden-xs">
            <div class="thumbnail">
              <img src="/images/thumb_demisx.jpg" alt="demisx avatar">
              <div class="caption small">
                <b><u>#inspect:</u></b>
                <p>I am Dmitri Moore, full stack programmer. I've been coding for almost 
                2 decades now. I've seen many frameworks going from
                super popular to fairly forgotten. So far, P/MEAN is my favorite stack:<br/>
                <button type="button" class="btn btn-default btn-sm"><u>P</u>ostgreSQL</button>
                <button type="button" class="btn btn-default btn-sm"><u>M</u>ongoDB</button>
                <button type="button" class="btn btn-default btn-sm"><u>E</u>xpress</button>
                <button type="button" class="btn btn-default btn-sm"><u>A</u>ngularJS</button>
                
                <button type="button" class="btn btn-default btn-sm"><u>N</u>ode.js</button>
                <br/>Let's see how long this
                one is gonna stick around. <i class="fa fa-smile-o"></i></p>
              </div> 
            </div>
          </div>
          <div class="col-xs-12 col-sm-9 col-sm-pull-3 col-md-10 col-md-pull-2" id="main-content">
            <h2>How to Configure CORS Accept Headers in Rails API Application</h2>
<hr>
<p class="meta">18 Feb 2014</p>

<div class="post">
<p>You&#39;ve finally realized the value of SOA 
(<a href="http://en.wikipedia.org/wiki/Service-oriented_architecture">Service Oriented Architecturee</a>) 
and decided to move all of your dynamic functionality into an independent service layer. Smart!</p>

<p>You start turning your cool dynamic features into REST JSON web services and then have your HTML 
sites (a.k.a consumer) query these services for JSON data (a.k.a. provider). However, the response from 
your web service is coming back blank, though the HTTP response status says 200 OK and
you can see JSON data when accessing the web service endpoint directly. Sounds familiar?</p>

<p>What you may be dealing with here is known as a 
<a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin Resource Sharing (CORS)</a> 
and covers situations where a web service you are querying is on a different site compared to the one 
initiating the request. Browsers ban such requests trying to comply with so-called
&quot;<a href="http://en.wikipedia.org/wiki/Same_origin_policy">Same Origin Security Policy</a>&quot;.</p>

<p>Here, it is important to understand what a site is in this particular context:</p>

<div class="alert alert-warning">
<i class="fa fa-lightbulb-o fa-2x"></i> "Site" is a combination of scheme, hostname, and port number.
</div>

<p>So, even if your consumer is on &quot;localhost:3000&quot; and your provider is on &quot;localhost:3001&quot;, the response
will be neglected unless your web service sets a permissive CORS policy. This policy is 
defined by the provider setting specific CORS headers in HTTP response that a consumer app 
(e.g. a browser) destined to enforce. For example, configuring these headers:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># in config/application.rb </span>
<span class="n">config</span><span class="o">.</span><span class="n">action_dispatch</span><span class="o">.</span><span class="n">default_headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Access-Control-Allow-Origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://my-web-service-consumer-site.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Access-Control-Request-Method&#39;</span> <span class="o">=&gt;</span> <span class="sx">%w{GET POST OPTIONS}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
  <span class="p">}</span></code></pre></div>


will allow a web service to service `GET | POST | OPTIONS` requests from your 
`http://my-web-service-consumer-site.com` site.

<div class="alert alert-danger">
  <i class="fa fa-exclamation-circle fa-2x"></i>   Please note, that setting 
  'Access-Control-Allow-Origin' => '*' is highly discouraged, unless you
  are providing a public API that is intended to be accessed by any consumer out there.
</div>

<p>If you want to allow multiple sites to access your web service, the recommended way is to have your 
server read the Origin header from the consumer, compare that to the list of sites you&#39;d like to allow, 
and, if it matches, send the value of the Origin header back to the consumer as the 
<code>Access-Control-Allow-Origin</code> header in the response. Simply listing multiple sites or adding multiple
<code>Access-Control-Allow-Origin</code> headers in the response doesn&#39;t appear to produce consistent results
accross different browsers.</p>

<p>For those, who prefer to define CORS policy via Rack middleware, take a look at this 
rails-cors (<a href="https://github.com/cyu/rack-cors">https://github.com/cyu/rack-cors</a>) gem.</p>

<hr>

<h5 id="today-my-environment-was:">Today my environment was:</h5>

<ul>
<li>Rails 4.0.2</li>
<li>rails-api 0.2.0</li>
</ul>

</div>

<hr>
 <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'demisx'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  var disqus_shortname = 'demisx'; // required: replace example with your forum shortname

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function () {
      var s = document.createElement('script'); s.async = true;
      s.type = 'text/javascript';
      s.src = '//' + disqus_shortname + '.disqus.com/count.js';
      (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());
</script>
          </div>
        </div>
      </div>
        
      </div>
    </section>

    <footer>
      <div class="container">
        <hr>
        <div id="copyright">
          <p>&copy; 2014 All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-47168884-1', 'demisx.github.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
